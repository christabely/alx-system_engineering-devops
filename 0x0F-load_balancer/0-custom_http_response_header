#!/usr/bin/env bash
# Configure Nginx so that its HTTP response contains a custom header (on web-01 and web-02)
# The name of the custom HTTP header must be X-Served-By
# The value of the custom HTTP header must be the hostname of the server Nginx is running on

# Update the system and install Nginx
sudo apt-get update
sudo apt-get -y install nginx

# Configure firewall to allow both HTTP and HTTPS traffic
sudo ufw allow 'Nginx Full'

# Create necessary directories and set permissions
sudo mkdir -p /var/www/html
sudo chmod -R 755 /var/www

# Create the index page
echo 'Hello World!' | sudo tee /var/www/html/index.html

# Create a custom 404 error page
echo "Ceci n'est pas une page" | sudo tee /var/www/html/404.html

# Configure Nginx to add the custom header and handle redirects
nginx_config="/etc/nginx/sites-available/default"

# Add the "add_header" directive for custom header
echo 'add_header X-Served-By $hostname;' | sudo tee -a "$nginx_config"

# Configure redirect for a single page (/redirect_me)
echo 'location /redirect_me {
    return 301 https://www.blog.ehoneahobed.com;
}' | sudo tee -a "$nginx_config"

# Configure the custom error page for 404 errors
echo 'error_page 404 /404.html;
location = /404.html {
    root /var/www/html;
    internal;
}' | sudo tee -a "$nginx_config"

# Restart Nginx to apply the changes
sudo service nginx restart

# Ensure Nginx starts on system boot
sudo systemctl enable nginx

# Display a message indicating successful configuration
echo "Nginx configuration is complete."

